FROM nsjailcontainer

ARG USERNAME=magpie
RUN useradd -m $USERNAME
RUN chmod a-w /home/$USERNAME

COPY ./app/intact /root/intact
COPY ./app/flag.txt /home/magpie/flag.txt
RUN chmod o+x /root/intact

EXPOSE 2007

CMD ["/bin/nsjail",                 \
        "-Ml",                      \
        "--hostname", "host",       \
        "--port", "2007",           \
        "--user", "1001",           \
        "--group", "1001",          \
        "--chroot", "/",            \
        "-E", "TERM=xterm",         \
        "--cwd", "/home/magpie",    \
        "--",                       \
        "/root/intact"               \
    ]
